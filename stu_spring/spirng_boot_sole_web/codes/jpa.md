# JPA
- ORM이란?
    - Object Relational Mapping 의 약자로, 관계형 데이터베이스에 매핑해주는 기술이다.
    - 객체 지향 프로그래밍 언어와 데이터베이스 간의 매핑이기 때문에 자바에만 있지 않다.
- JPA란?
    - 자바의 표준 ORM 기술
    - 즉 JPA는 ORM이라는 기술을 통해 자바의 객체와 관계형 db를 매핑시켜주는 기술이다.
- JPA의 특징
    - SQL문을 개발자 대신 해 줌으로써 반복적인 CRUD를 위한 SQL을 작성하지 않아도 된다.
    - SQL문을 직접 작성하지 않아 객체가 변화해도 엔티티의 속성만 수정하면 되어 유지보수가 편하다.
    - 관계형 데이터베이스와 자바의 객체 사이의 차이로 인해 생기는 어려움(패러다임 불일치)을 해결해준다.
    - JPA는 표준이기 때문에 다른 프레임워크로 변경이 쉽다.
    - 기존 SQL보다 훨씬 직관적이다.
- 단점
    - 직접 SQL을 사용하는 것 보다 복잡해질 수 있다.
    - 속도나 생산성이 저하될 수 있다.
    - 완전히 ORM만 사용할 수 없기 때문에 DBMS로부터 완전히 독립할 수 없다.
        - 이 경우에는 @Query(value="쿼리문")을 통해 만들 수 있다.
    - 테이블보다 더 많은 객체를 만들게 될 수 있다.
    - 탐색과 순회에서 자바는 객체간의 연결을 통해, RDBMS는 쿼리를 최적화해서 탐색한다.
        - 그래서 JPA는 속도가 느려질 수 있다.
# Entity 객체의 생명주기
<img src = "https://t1.daumcdn.net/cfile/tistory/233A5A475551AB5617">

- Entity 객체의 생명주기
    - New(비 영속 객체)
        - Entity 객체가 db에 반영되지 않음
        - 아직 영속 객체가 되지 않음
        - new 키워드를 통해 생성된 객체
    - Managed(영속 객체)
        - 영속 객체가 되는 경우
            - persist 메소드를 통해 new의 객체를 저장했을 때
            - find 메소드를 통해 조회했을 경우
        - 해당 객체가 수정되었는지 자동으로 알아낸다.
        - Persistence Context(영속성 컨텍스트)가 관리하는 상태
    - Removed(삭제 객체)
        - Managed 상태의 객체를 remove 메소드를 통해 삭제한 상태
        - 작업 종료 시점에서 실제 DB 테이블에 동기화가 된다
        - 재사용하면 안된다.
    - Detached(준 영속 객체)
        - DB와의 동기화를 보장하지 않는다.
        - 영속 객체가 될 수 있는 merge 메소드가 있다.
        - Detached 가 되는 경우
            - 트랜잭션 commit
            - clear 메소드 실행 
            - flush 메소드 실행
- Persistence Context(영속성 컨텍스트)
    - 영속 객체가 영속성 컨텍스트에서 관리된다.
    - 영속성 컨텍스트가 작업 단위에서 다루는 모든 객체는 영속성 컨텍스트에서 관리한다.
    - 자동 변경 감지
        - 객체의 속성의 변경을 감지하고, 영속성 컨텍스트에서 관리되는 객체와 동기화 해 준다.
        - 즉, 영속 객체는 작업 단위가 종료될 때 동기화 된다.
    - 캐시
        - key를 기준으로 Entity를 조회했다면, DB를 조회하기 전 영속성 컨텍스트의 영속 객체에서 조회한다.
        - 영속성 컨텍스트에 영속 객체가 없을때만 DB에서 조회한다.
    - 객체 동일성
        - 자바와 DB 데이터 모두 일치해야 동일하다고 판단한다.
        - DB에서는 KEY가 일치한 경우에만 동일하다고 판단한다.
        - 하지만 작업 단위가 다른경우 다르다고 판단한다.
# 스프링 부트 JPA 적용
- Entity
    - 데이터베이스의 테이블과 1:1 매칭되는 클래스
    - 절대 setter를 쓰지 않는다.
    - @Entity
        - 이 클래스가 데이터베이스와 매칭될 클래스 라는 것을 명시한다.
    - @Table
        - 이 클래스가 매핑될 테이블을 설정해 준다.
        - @Table 어노테이션이 없다면 기본적으로 클래스 이름을 언더스코어 네이밍으로 매칭시켜준다.
    - @Id
        - 해당 클래스의 PK값을 나타낸다.
        - @GeneratedValue(strategy = PK 종류)
            - PK 생성 규칙을 나타낸다.
            - IDENTITY
                - 간단하게 AUTO_INCREMENT 이다.
                - PK값 생성을 여기서 하는게 아니라, 데이터베이스가 자동으로 생성해주기를 기대?하는 것이다.
            - 만약 유저의 email과 같이 unique한 값이 PK라면 굳이 사용하지 않아도 된다.
    - @Column
        - 해당 테이블의 컬럼과 1:1로 매핑시켜준다.
        - name
            - 해당 컬럼의 이름을 지정해 준다.
            - 기본값은 변수 이름을 언더스코어 네이밍 한 것이다.
        - table
            - 다른 테이블에 매핑을 시켜주고 싶을때 사용
        - nullable
            - null값 허용 여부
        - unique
            - 제약 조건
        - length
            - varchar나 char같은 경우에 길이를 지정해 준다.
- Repository
    - repository 메소드
        - postsRepository.save
            - posts 테이블의 insert와 update 쿼리를 실행한다.
            - id값이 있으면 update, 없으면 insert를 실행한다.
        - postsRepository.findAll
            - posts에 있는 모든 데이터를 조회한다.
            - findAllByName(String name)과 같이, 원하는 조건이 있다면 그 조건을 By 뒤에 적고, name에 적으면 해당 name인 데이터만 가져온다.
            - And를 통해 And 연산을 시킬 수 있다.
            - Or를 통해 Or 연산을 시킬 수 있다.
            - 필드Between(시작값, 끝값)
                - 필드중 시작값과 끝값 사이에 있는 데이터만 추린다.
            - LessThan
                - 해당 값보다 작은 값만 추린다.
            - LessThanEqual
                - 해당 값보다 작거나 같은 값만 추린다.
            - GreaterThan
                - 해당 값보다 큰 값만 추린다.
            - GreaterThanEqual
                - 해당 값보다 크거나 같은 값만 추린다.
            - Like
                - 내가 원하는 문자열과 비슷한 값만 추린다.
            - IsNull
                - 해당 값이 NULL인 값을 찾는다
                - 매개변수가 필요 없다.
            - In
                - 여러 값들중 하나라도 포함하고 있는 값을 가져온다.
            - OrderBy필드
                - 값들을 원하는 필드를 기준으로 정렬시킨다.
                - Asc와 Desc로 각각 오름차순, 내림차순을 시킬 수 있다.
            - Pageable
                - return 타입이 Pageable이면, 우리가 흔히 보는 페이지로 나누어진 웹사이트처럼 값을 받을 수 있다.
                    - 만약 한 페이지에 6개의 데이터가 들어가는 곳의 3번째 페이지라면, 내가 원하는 값들만 가져온다.
                - 반환값이 Pageable이라면 매개변수에 page와 size를 줘야 한다.
                
    - JPA 인터페이스
        - JpaRepository
            - 기본적인 메소드들이 자동으로 생성된다.
            - 다른 인터페이스들의 부모이다.
            - List 타입을 반환한다.
        - CrudRepository
            - CRUD 기능 위주로 제공한다.
            - Iterable 타입으로 반환한다.
        - PagingAndSortingRepository
            - 페이지 및 정렬을 위주로 제공한다.
            - Page 타입을 반환한다.